*This Readme is generated by Claude 4.0*

# Molecular Geometry Tools

A comprehensive suite of tools for molecular structure analysis, alignment, and reaction pathway interpolation.

## Overview

This project provides three integrated tools for molecular geometry manipulation:
- **xyzgeom**: Enhanced molecular geometry analyzer with 14+ analysis functions
- **calc_rmsd_xyz**: High-precision RMSD calculator and structure aligner using Fortran/LAPACK
- **neb_interpolator**: NEB (Nudged Elastic Band) and LIIC interpolation for reaction pathways

## Features

### XYZ Geometry Analyzer (xyzgeom)
- Calculate distances, angles, and dihedrals
- Atom manipulation (swap, mirror, export)
- Structure alignment using RMSD
- NEB interpolation integration
- Support for both Angstrom and Bohr units
- Gview-compatible atom selection syntax

### RMSD Calculator (calc_rmsd_xyz)
- Precise structure alignment using SVD decomposition
- Support for both .xyz and .gjf formats
- Partial structure alignment with atom range selection
- Optimal rotation matrix calculation

### NEB Interpolator
- Linear Interpolation of Internal Coordinates (LIIC)
- Nudged Elastic Band (NEB) optimization
- Automatic structure alignment before interpolation
- Configurable convergence parameters

## Requirements

### Compiler Requirements
- C++11 compatible compiler (GCC 4.8+, Intel C++ 2013+)
- Fortran compiler (gfortran 4.8+, ifort 2013+)
- CMake 3.10+

### Library Dependencies
- BLAS/LAPACK (system libraries or Intel MKL)
- POSIX system for file operations

### Optional
- Intel MKL for optimized linear algebra operations

## Installation

### 1. Clone or Download the Project
```bash
git clone <repository-url>
cd MolecularGeometryTools
```

### 2. Directory Structure
```
MolecularGeometryTools/
├── CMakeLists.txt
├── README.md
├── src/
│   ├── xyzgeom.cpp           # Main geometry analyzer
│   ├── calc_rmsd_xyz.f90     # Fortran RMSD calculator
│   ├── neb_interpolator.cpp  # Standalone NEB tool
│   └── neb_interpolator.h    # NEB library header
└── build/                     # Build directory (create this)
```

### 3. Build the Project
```bash
mkdir build
cd build
cmake ..
make -j4
```

### 4. (Optional) Install System-wide
```bash
sudo make install
```

### 5. Verify Installation
```bash
make test_all  # Run all tests
make usage     # Show usage information
```

## Usage

### XYZ Geometry Analyzer

#### Interactive Mode
```bash
./bin/xyzgeom molecule.xyz
```

Interactive menu options:
- **-1**: Print current structure to screen
- **1**: Calculate distance between 2 atoms
- **2**: Swap two atoms
- **3**: Calculate bond angle (3 atoms)
- **4**: Calculate angle between two planes
- **5**: Mirror through plane
- **6**: Calculate dihedral angle (4 atoms)
- **7**: Calculate geometric center
- **8**: Export selected atoms
- **9**: Find atoms within radius
- **10**: Export current structure
- **11**: Load new XYZ file
- **12**: Toggle units (Bohr/Angstrom)
- **13**: Align with second XYZ file (RMSD)
- **14**: NEB interpolation with second XYZ

#### Command Line Mode
```bash
# Print structure
./bin/xyzgeom molecule.xyz --print

# Swap atoms 1 and 3
./bin/xyzgeom molecule.xyz --swap 1,3

# Mirror through plane defined by atoms 1,2,3
./bin/xyzgeom molecule.xyz --mirror 1-3
```

### RMSD Calculator

This program is a fine-tuned version based on jxzou's [RMSD program](https://gitlab.com/jxzou/rmsd), added support for xyz files.

```bash
# Basic alignment
./bin/calc_rmsd_xyz reference.xyz mobile.xyz

# Align with atom selection
./bin/calc_rmsd_xyz reference.xyz mobile.xyz 1-10 1-10

# Mixed format support
./bin/calc_rmsd_xyz reference.gjf mobile.xyz
```

Output: Creates `mobile_new.xyz` with aligned structure

### NEB Interpolator

```bash
# Basic NEB interpolation with 5 images
./bin/neb_interpolator initial.xyz final.xyz

# LIIC interpolation with 10 images
./bin/neb_interpolator -n 10 -m liic initial.xyz final.xyz

# Custom parameters
./bin/neb_interpolator -n 7 -m neb -s 0.0002 -c 0.005 -i 5000 initial.xyz final.xyz

# Without alignment
./bin/neb_interpolator --no-align initial.xyz final.xyz

# Multiframe output
./bin/neb_interpolator -o multiframe initial.xyz final.xyz
```

Options:
- `-n, --nimages NUM`: Number of intermediate images (default: 5)
- `-m, --method METHOD`: Interpolation method: liic or neb (default: neb)
- `-p, --prefix PREFIX`: Output filename prefix
- `-o, --output MODE`: Output mode: separate or multiframe
- `-s, --step STEP`: Step size for NEB (default: 0.0001)
- `-c, --conv THRESHOLD`: Convergence threshold (default: 0.01)
- `-i, --maxiter ITER`: Maximum iterations (default: 10000)
- `-a, --align`: Enable structure alignment (default)
- `--no-align`: Disable structure alignment
- `-r, --rmsd-exec PATH`: Path to calc_rmsd_xyz executable

## Example Workflows

### 1. Reaction Pathway Analysis
```bash
# Load initial structure
./bin/xyzgeom reactant.xyz

# In interactive mode:
# - Choose option 13 to align with product.xyz
# - Choose option 14 for NEB interpolation
# - Enter number of images (e.g., 10)
# - Choose NEB method
# Output: neb_00.xyz to neb_11.xyz
```

### 2. Structure Comparison
```bash
# Calculate RMSD between two conformers
./bin/calc_rmsd_xyz conformer1.xyz conformer2.xyz

# Align and analyze
./bin/xyzgeom conformer1.xyz
# Choose option 13, enter conformer2.xyz
# Choose option 1 to measure specific distances
```

### 3. Batch Processing
```bash
#!/bin/bash
# Process multiple structure pairs
for i in {1..10}; do
    ./bin/neb_interpolator structure${i}_initial.xyz structure${i}_final.xyz \
        -n 5 -p pathway${i}_ -m neb
done
```

## Atom Selection Syntax

The tools support Gview-compatible selection syntax:
- Single atoms: `1,3,5`
- Ranges: `1-10`
- Mixed: `1-3,5,7-10`
- Full-width comma support: `1，2，3`

## Output Files

- **XYZ files**: Standard XYZ format with atomic coordinates
- **_new suffix**: Aligned/modified structures from calc_rmsd_xyz
- **Numbered sequences**: 00.xyz (initial), 01.xyz...N.xyz (intermediates), N+1.xyz (final)
- **trajectory.xyz**: Multiframe XYZ for visualization in VMD/PyMOL

## Performance Tips

1. **Use Intel MKL**: Set `MKLROOT` environment variable before building
2. **Convergence**: Adjust step size and threshold for faster/more accurate results
3. **Large systems**: Use LIIC for initial guess, then refine with NEB
4. **Alignment**: Pre-align structures for better interpolation quality

## Troubleshooting

### Common Issues

1. **Compilation errors with MKL**
   ```bash
   # Use system BLAS/LAPACK instead
   cmake .. -DUSE_MKL=OFF
   ```

2. **calc_rmsd_xyz not found**
   ```bash
   # Specify full path in xyzgeom
   ./bin/xyzgeom molecule.xyz
   # When prompted for alignment, ensure calc_rmsd_xyz is in PATH or same directory
   ```

3. **Convergence issues in NEB**
   - Reduce step size: `-s 0.00001`
   - Increase max iterations: `-i 20000`
   - Try LIIC first: `-m liic`

## Algorithm Details

### RMSD Alignment
Uses Kabsch algorithm with SVD decomposition to find optimal rotation matrix minimizing RMSD between two structures.

### NEB Method
Implements climbing image NEB with:
- Spring forces along reaction coordinate
- Perpendicular forces for distance preservation
- Adaptive step size optimization

### Distance Matrix Preservation
Maintains internal coordinates during interpolation to prevent unrealistic intermediate structures.

## Citation

If you use these tools in your research, please cite:
```
Molecular Geometry Tools
[Your Name/Institution]
[Year]
```

## Contributing

Contributions are welcome! Please submit pull requests or issues on the project repository.


---
*Last updated: 25.9.4*